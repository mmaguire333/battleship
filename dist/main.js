(()=>{"use strict";function e(){let e=[];for(let t=0;t<100;t++)e.push({material:"water",beenHit:!1});return{grid:e,ships:[],shipOutOfBounds(e){let t=e.position%10,r=Math.floor(e.position/10);return"h"===e.orientation?t+e.length>=10:"v"===e.orientation?r+e.length-1>=10:void 0},placeShip(e,t,r){let i={position:e,orientation:t,length:r,numHits:0,hit(){this.isSunk()||this.numHits++},isSunk(){return this.numHits>=this.length}};if(this.shipOutOfBounds(i))return!1;if("h"===i.orientation){for(let e=i.position;e<i.position+i.length;e++)if("ship"===this.grid[e].material)return!1}else if("v"===i.orientation)for(let e=i.position;e<=i.position+10*(i.length-1);e+=10)if("ship"===this.grid[e].material)return!1;if("h"===i.orientation)for(let e=i.position;e<i.position+i.length;e++)this.grid[e].material="ship";if("v"===i.orientation)for(let e=i.position;e<=i.position+10*(i.length-1);e+=10)this.grid[e].material="ship";return this.ships.push(i),!0},getShipAtCoordinate(e){for(let t=0;t<this.ships.length;t++){if("h"===this.ships[t].orientation)for(let r=this.ships[t].position;r<this.ships[t].position+this.ships[t].length;r++)if(r===e)return this.ships[t];if("v"===this.ships[t].orientation)for(let r=this.ships[t].position;r<=this.ships[t].position+10*this.ships[t].length;r+=10)if(r===e)return this.ships[t]}},recieveAttack(e){let t=this.getShipAtCoordinate(e);if(!1===this.grid[e].beenHit)return this.grid[e].beenHit=!0,null!=t?(t.hit(),"hit"):"miss"}}}function t(t,r){return{name:t,previousShots:[],board:e(),randomAttack(){let e=Math.floor(100*Math.random());return this.previousShots.includes(e)?this.randomAttack():(this.previousShots.push(e),e)},generateFleetData(){let e=[];for(let t=0;t<10;t++){let r=Math.floor(2*Math.random())%2==0?"h":"v",i=-1;0===t?i=4:1===t||2===t?i=3:t>=3&&t<=5?i=2:t>5&&(i=1);let o=-1,n=[],s=[];for(let t=0;t<e.length;t++){if("h"===e[t].orientation)for(let r=e[t].position;r<e[t].position+e[t].length;r++)s.push(r);if("v"===e[t].orientation)for(let r=e[t].position;r<e[t].position+10*e[t].length;r+=10)s.push(r)}for(let e=0;e<100;e++){let t=[],o=e%10,l=Math.floor(e/10);if("h"===r){if(o+i>=10)continue;e%10!=0&&(t.push(e-1),e>9&&t.push(e-1-10),e<90&&t.push(e-1+10)),(e+i-1)%10!=9&&(t.push(e+1),e>9&&t.push(e+1-10),e<90&&t.push(e+1+10));for(let r=e;r<e+i;r++)t.push(r),r>9&&t.push(r-10),r<90&&t.push(r+10)}if("v"===r){if(l+(i-1)>=10)continue;e>9&&(t.push(e-10),e%10!=0&&t.push(e-10-1),e%10!=9&&t.push(e-10+1)),e+10*(i-1)<90&&(t.push(e+10*i),e%10!=0&&t.push(e+10*i-1),e%10!=9&&t.push(e+10*i+1));for(let r=e;r<e+10*i;r+=10)t.push(r),e%10!=0&&t.push(r-1),e%10!=9&&t.push(r+1)}!1===t.some((e=>s.includes(e)))&&n.push(e)}o=n[Math.floor(Math.random()*n.length)],e.push({position:o,orientation:r,length:i})}return e}}}function r(e){for(let t=0;t<e.ships.length;t++)if(!1===e.ships[t].isSunk())return!1;return!0}let i,o,n,s,l,a=!1;document.getElementById("form-submit").addEventListener("click",(()=>{if(!document.getElementById("player-name").checkValidity())return void alert("Please enter name");let e=document.getElementById("player-name").value;i=t(e),o=t("Computer"),n=i.generateFleetData(),s=o.generateFleetData();for(let e=0;e<n.length;e++)i.board.placeShip(n[e].position,n[e].orientation,n[e].length);for(let e=0;e<s.length;e++)o.board.placeShip(s[e].position,s[e].orientation,s[e].length);l=function(e,t){let r=document.querySelector(".player-one-grid");r.style.display="grid";let i=document.querySelector(".player-two-grid");i.style.display="grid",document.querySelector(".player-one-name").textContent=e.name,document.querySelector(".player-two-name").textContent="Computer";let o=[],n=[];for(let e=0;e<100;e++){let t=document.createElement("div");t.id=e,t.classList.add("player-grid-square"),o.push(t);let s=document.createElement("div");s.classList.add("computer-grid-square"),s.id=e,n.push(s),r.appendChild(t),i.appendChild(s)}return{playerBoard:r,computerBoard:i,renderPlayerBoard(){for(let t=0;t<e.board.grid.length;t++)"ship"===e.board.grid[t].material&&(!0===e.board.grid[t].beenHit?(o[t].style.backgroundColor="red",o[t].textContent="×",o[t].style.color="black"):o[t].style.backgroundColor="blue"),"water"===e.board.grid[t].material&&!0===e.board.grid[t].beenHit&&(o[t].textContent="•",o[t].style.backgroundColor="#eeeeee",o[t].style.color="black")},renderComputerBoard(){for(let e=0;e<t.board.grid.length;e++)!0===t.board.grid[e].beenHit&&("ship"===t.board.grid[e].material&&(n[e].style.backgroundColor="red",n[e].textContent="×",n[e].style.color="black"),"water"===t.board.grid[e].material&&(n[e].textContent="•",n[e].style.backgroundColor="#eeeeee",n[e].style.color="black"))},clearPlayerBoard(){for(let e=0;e<o.length;e++)o[e].textContent="",o[e].style.backgroundColor="white"},clearComputerBoard(){for(let e=0;e<n.length;e++)n[e].textContent="",n[e].style.backgroundColor="white"},displayWinMessage(e){document.querySelector(".winner-message").textContent=e.name+" wins!"}}}(i,o),l.renderPlayerBoard(),l.renderComputerBoard(),document.querySelector(".randomize-button").style.display="block",document.querySelector(".play-button").style.display="block",document.querySelector(".new-game").style.display="flex",document.querySelector("form").style.display="none"})),document.addEventListener("click",(e=>{let t=e.target.closest(".computer-grid-square");if(!1!==a&&t){let e=Number(t.id);if(i.previousShots.includes(e))return;if(i.previousShots.push(e),o.board.recieveAttack(e),l.renderComputerBoard(e),r(o.board))return l.displayWinMessage(i),void(a=!1);setTimeout((()=>{let e=o.randomAttack();if(i.board.recieveAttack(e),l.renderPlayerBoard(),r(i.board))return l.displayWinMessage(o),void(a=!1)}),200)}})),document.addEventListener("click",(e=>{if(e.target.closest(".randomize-button")){let e=i.generateFleetData();for(let e=0;e<i.board.grid.length;e++)i.board.grid[e]={material:"water",beenHit:!1};l.clearPlayerBoard();for(let t=0;t<e.length;t++)i.board.placeShip(e[t].position,e[t].orientation,e[t].length);l.renderPlayerBoard()}}));let d=document.querySelector(".play-button");d.addEventListener("click",(()=>{a=!0,d.style.display="none",document.querySelector(".randomize-button").style.display="none"}))})();